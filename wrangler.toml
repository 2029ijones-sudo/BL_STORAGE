name = "bl-storage-api"
main = "dist/worker.js"  # Changed from worker.js to dist/worker.js
compatibility_date = "2026-01-30"  # Updated to current date
compatibility_flags = ["nodejs_compat"]

[env.production]
workers_dev = true
routes = [
  { pattern = "api.blstorage.dev/*", zone_name = "blstorage.dev" }
]

[vars]
BL_SECRET_KEY = "{{BL_ENCRYPTION_KEY}}"
BL_MAX_STORAGE_MB = "1024"
BL_REPLICATION_FACTOR = "3"
BL_ENABLE_QUANTUM_INDEX = "true"

[build]
command = "npm run build"

# Add Durable Objects bindings section
[durable_objects]
bindings = [
  { name = "BL_STORAGE", class_name = "BLStorage" },
  { name = "BL_USER", class_name = "BLUser" },
  { name = "BL_INDEX", class_name = "BLIndex" }
]

[[migrations]]
tag = "v1"
new_classes = ["BLStorage", "BLUser", "BLIndex"]

[placement]
mode = "smart"
